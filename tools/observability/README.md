[See docs here](https://docs.determined.ai)

# Metrics
Determined does not produce metrics, rather it uses existing tools to report information. Please see source documentation for details on specific metrics.

## API Performance Metrics
Determined master reports API performance metrics using [grpc ecosystem](https://github.com/grpc-ecosystem/go-grpc-prometheus?tab=readme-ov-file#metrics).

## Kubernetes and Container Metrics
The kube-prometheus-stack enables kube-state-metrics and cAdvisor by default. 

- [kube-state-metrics](https://github.com/kubernetes/kube-state-metrics/tree/main/docs#exposed-metrics) reports the state of kubernetes objects, including Determined and any resources it creates
- [cAdvisor](https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md) reports resource usage and performance of running containers, for example memory and cpu used

## Nvidia DCGM Exporter
Nvidia's Data Center GPU Manager collects data on Nvidia GPUs. 
- by default, only the most useful [subset](https://github.com/GoogleCloudPlatform/prometheus-engine/blob/8dd8a187486cccb5ede3132e5773ae786239dbc2/examples/nvidia-dcgm/exporter.yaml#L139-L169) of metrics are scraped by Prometheus
- the full list of metrics generated by DCGM exporter can be found [here](https://github.com/NVIDIA/dcgm-exporter/blob/main/etc/dcp-metrics-included.csv)

## Viewing Metrics
The Determined Master labels pods it creates with Determined state values. The following pod labels can be accessed via `kube_pod_labels` metric from kube-state-metrics. Label names will be formatted as `label_determined_ai_<label_name>`, e.g. `label_determined_ai_container_id`. 
| Key    | Value Description |
| -------- | ------- |
| determined.ai/container_id  |     |
| determined.ai/experiment_id | `task_type=TRIAL` only    |
| determined.ai/resource_pool | name of the resource pool, including `default`     |
| determined.ai/task_id       |     |
| determined.ai/task_type     | Determined task type, e.g. `TRIAL`, `NOTEBOOK`, `TENSORBOARD`     |
| determined.ai/trial_id      | `task_type=TRIAL` only     |
| determined.ai/user          | Determined username that initiated the request    |
| determined.ai/workspace     | name of the workspace, including `Uncategorized    |

Kubernetes resource metrics and GPU metrics can be broken down by Determined resources by joining data metrics with `kube_pod_labels` state metric. Some helpful resources (see PromQL documentation for more details):
- [joining metrics](https://github.com/kubernetes/kube-state-metrics/tree/main/docs#join-metrics) from kube-state-metrics
- [matching vectors](https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching) from Prometheus