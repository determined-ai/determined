prometheus:
  prometheusSpec:
    volumes:
      - name: det-secret-volume
        secret:
          secretName: det-prom-token

    volumeMounts:
      - name: det-secret-volume
        mountPath: /tmp/det-secret

    additionalScrapeConfigs:
      - job_name: det-master-api-server
        honor_timestamps: true
        scrape_interval: 1s # TODO 5s or 15s?
        scrape_timeout: 1s
        metrics_path: /debug/prom/metrics
        scheme: http
        follow_redirects: true
        authorization:
          type: Bearer
          credentials_file: /tmp/det-secret/det-token

          #credentials_file: $PATH_TO_TOKEN
        kubernetes_sd_configs:
        - role: service
          selectors:
            - label: determined.ai/master-service=true
              role: service

      - job_name: gpu-metrics
        scrape_interval: 1s
        metrics_path: /metrics
        scheme: http
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
            - gpu-operator
            - gmp-public
        relabel_configs:
        - source_labels: [__meta_kubernetes_endpoints_name]
          action: drop
          regex: .*-node-feature-discovery-master
        - source_labels: [__meta_kubernetes_pod_node_name]
          action: replace
          target_label: kubernetes_node

#     podMonitorNamespaceSelector:
#       any: true
#     podMonitorSelector: {}
#     podMonitorSelectorNilUsesHelmValues: false
#     ruleNamespaceSelector:
#       any: true
#     ruleSelector: {}
#     ruleSelectorNilUsesHelmValues: false
#     serviceMonitorNamespaceSelector:
#       any: true
#     serviceMonitorSelector: {}
#     serviceMonitorSelectorNilUsesHelmValues: false
# grafana:
#   enabled: true
# #  adminPassword: prom-operator # Please change the default password in production !!!        
