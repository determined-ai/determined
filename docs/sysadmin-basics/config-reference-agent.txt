.. _agent-configuration:

###############################
 Agent Configuration Reference
###############################

The default agent configuration file is ``/etc/determined/agent.yaml``. The file contains the
following configuration parameters:

+------------------------------+-------------------------------------------------------------------+
| Key                          | Description                                                       |
+==============================+===================================================================+
| ``config_file``              | Path to the agent configuration file. Normally this should only   |
|                              | be set via an environment variable or command-line                |
+------------------------------+-------------------------------------------------------------------+
| ``master_host``              | (Required) Determined master hostname or IP address.              |
+------------------------------+-------------------------------------------------------------------+
| ``master_port``              | Determined master port. |br| Default = ``443`` if TLS is enabled. |
|                              | Otherwise, port = ``80``.                                         |
+------------------------------+-------------------------------------------------------------------+
| ``agent_id``                 | ID of this agent. |br| Default = hostname of the current machine. |
|                              | Agent IDs must be unique within a cluster.                        |
+------------------------------+-------------------------------------------------------------------+
| ``container-master-host``    | Master hostname that containers started by this agent will        |
|                              | connect to. |br| Defaults = ``master_host``.                      |
+------------------------------+-------------------------------------------------------------------+
| ``container-master-port``    | Master port that containers started by this agent will connect    |
|                              | to. |br| Default = ``master_port``.                               |
+------------------------------+-------------------------------------------------------------------+
| ``resource_pool``            | Which resource pool the agent should join. Defaults to the value  |
|                              | of ``default``, which works if and only if there is a resource    |
|                              | pool named ``default``. If you are using the old version of the   |
|                              | master configuration, which predates resource pools, a resource   |
|                              | pool named ``default`` is automatically created. If you are using |
|                              | the new version of the master configuration and have specified    |
|                              | resource pools, this field needs to be set correctly for the      |
|                              | agent to join successfully. For more information, see             |
|                              | :ref:`resource-pools`.                                            |
+------------------------------+-------------------------------------------------------------------+
| ``label``                    | The label to assign to this agent. An agent with a label is only  |
|                              | assigned workloads that have been assigned the same label. For    |
|                              | example, using the :ref:`agent_label <exp-config-agent_label>`    |
|                              | field in the experiment configuration.                            |
+------------------------------+-------------------------------------------------------------------+
| ``visible_gpus``             | The GPUs that should be exposed as slots by the agent. A          |
|                              | comma-separated list of GPUs, each specified by a 0-based index,  |
|                              | UUID, PCI bus ID, or board serial number. The 0-based index of    |
|                              | NVIDIA GPUs or AMD GPUs can be obtained via the ``nvidia-smi`` or |
|                              | ``rocm-smi`` commands.                                            |
+------------------------------+-------------------------------------------------------------------+
| ``slot_type``                | Slot type that should be exposed. Dynamic agents with GPUs are    |
|                              | configured to ``cuda``, agents without GPUs and with a            |
|                              | ``cpu_slots_allowed: true`` provisioner option are configured to  |
|                              | ``cpu``, and ``none``, otherwise. For static agents this field    |
|                              | defaults to ``auto``. |br| |ol| ``auto`` Automatically detects    |
|                              | the slot type. The agent will detect if there are NVIDIA GPUs or  |
|                              | AMD GPUs. If there are GPUs, it maps each GPU to one slot.        |
|                              | Otherwise, it maps all the CPUs to a slot. |br| |ol| ``cpu`` Map  |
|                              | all CPUs to a slot, even when GPUs are present. |br| |ol|         |
|                              | ``cuda`` The agent maps each detected NVIDIA GPU to a slot. Prior |
|                              | to version 0.17.6, this option was called ``gpu``. |br| |ol|      |
|                              | ``none`` The agent does not create slots for detected devices.    |
|                              | |br| |ol| ``rocm`` The agent maps each detected ROCm AMD GPU to a |
|                              | slot.                                                             |
+------------------------------+-------------------------------------------------------------------+
| ``http_proxy``               | HTTP proxy address for the agent containers.                      |
+------------------------------+-------------------------------------------------------------------+
| ``https_proxy``              | HTTPS proxy address for the agent containers.                     |
+------------------------------+-------------------------------------------------------------------+
| ``ftp_proxy``                | FTP proxy address for the agent containers.                       |
+------------------------------+-------------------------------------------------------------------+
| ``no_proxy``                 | Addresses that the agent containers should not proxy.             |
+------------------------------+-------------------------------------------------------------------+
| ``security``                 | Security-related configuration settings: |br| ``tls``             |
|                              | Configuration settings for :ref:`TLS <tls>`: |br| |ol|            |
|                              | ``enabled``: Whether to use TLS to connect to the master.         |
|                              | Defaults = ``false`` |br| |ol| ``skip_verify``: Skip verifying    |
|                              | the master certificate when using TLS. Defaults = ``false``.      |
|                              | Enabling this setting reduces the security of the Determined      |
|                              | cluster. |br| |ol| ``master_cert``: CA cert file for the master   |
|                              | when using TLS. |br| |ol| ``master_cert_name``: hostname for      |
|                              | which the master's TLS certificate is valid, if the value of the  |
|                              | ``master_host`` option is an IP address or is not contained in    |
|                              | the certificate.                                                  |
+------------------------------+-------------------------------------------------------------------+

.. |br| raw:: html

   <br />

.. |ol| raw:: html

   &nbsp;&nbsp;&nbsp;&nbsp;&#x2022;

.. |ol2| raw:: html

   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x2022;
