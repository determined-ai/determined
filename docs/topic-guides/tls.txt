.. _tls:

##########################
 Transport Layer Security
##########################

**Transport Layer Security** (TLS) is a protocol for applying encryption
to network communications. It prevents the data being transmitted from
being modified or read while it is in transit and allows clients to
verify the identity of the server (in this case, the Determined master).
Determined can be set up to use TLS for all connections made to the
master. That means that all CLI and WebUI connections will be secured by
TLS, as well as connections from agents and tasks to the master.
Communications within the cluster that occur as part of
:ref:`distributed training <multi-gpu-training>` do not use TLS, nor do
proxied connections from the master to a :ref:`TensorBoard
<how-to-tensorboard>` or :ref:`notebook <how-to-notebooks>` instance.

*******************************
 Configuring TLS in Determined
*******************************

Master
======

In order to :ref:`configure the master <master-configuration>` to use
TLS, set the ``security.tls.cert`` and ``security.tls.key`` options to
paths to a TLS certificate file and key file.

When TLS is in use, the default TCP port for the master to listen on if
none is specified is 8443 rather than 8080.

.. note::

   If the master's certificate is not signed by a well-known CA, then
   the configured certificate file must contain a full certificate chain
   that goes all the way to a root certificate.

Agents
======

When the Determined master is using TLS, set the
``security.tls.enabled`` :ref:`agent configuration option
<agent-configuration>` to ``true``. If the master's certificate is
signed by a well-known CA, then no other TLS-specific configuration is
necessary. Otherwise, for the best security, place the master's
certificate file somewhere accessible to the agent and set the agent's
``security.tls.master_cert`` option to the path to that file. For a more
convenient but less secure setup, instead set the
``security.tls.skip_verify`` option to ``true``. With the latter
configuration, the agent will be unable to verify the identity of the
master, but the data sent over the connection will still be protected by
TLS.

When :ref:`elastic infrastructure <elastic-infra-index>` and TLS are
both in use, the dynamic agents that the master creates will
automatically be configured to connect securely to the master over TLS.

CLI
===

In order to use TLS, the CLI must be configured with a master address
starting with ``https://`` using either the ``-m`` flag or
``DET_MASTER`` environment variable.

If the master's certificate is signed by a well-known CA, then the
connection should proceed immediately. If not, the CLI will indicate on
the first connection that the master is presenting an untrusted
certificate and display a hash of the certificate. You may wish to
confirm the hash with your system administrator; in any case, if you
confirm the connection to the master, the certificate will be stored on
the computer where the CLI is being run and future connections to the
master will be made without confirmation.

Tasks
=====

Once the master and agent are set up to use TLS, no further
configuration is required for tasks that are run in the cluster. In
shells and notebooks, the Determined :ref:`Python libraries
<experimental>` will automatically make connections to the master using
TLS with the appropriate certificate.
