DROP TABLE public.experiment_snapshots;

DROP TABLE public.trial_snapshots;

ALTER TABLE public.trials DROP COLUMN request_id;


CREATE TABLE public.searcher_events (
    id integer NOT NULL,
    experiment_id integer NOT NULL,
    event_type character varying NOT NULL,
    content jsonb NOT NULL
);

ALTER TABLE public.searcher_events ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.searcher_events_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);

ALTER TABLE ONLY public.searcher_events
    ADD CONSTRAINT searcher_events_pkey PRIMARY KEY (id);

CREATE INDEX ix_searcher_events_experiment_id ON public.searcher_events USING btree (experiment_id);

ALTER TABLE ONLY public.searcher_events
    ADD CONSTRAINT searcher_events_experiment_id_fkey FOREIGN KEY (experiment_id) REFERENCES public.experiments(id);
