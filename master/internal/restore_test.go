package internal

import (
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/determined-ai/determined/master/pkg/ptrs"
	"github.com/determined-ai/determined/master/pkg/schemas/expconf"
	"github.com/determined-ai/determined/master/pkg/searcher"
)

func TestShimExperimentSnapshotV4(t *testing.T) {
	//nolint:lll // Much more readable this way, than a hundreds of lines of formatted JSON.
	snapshot := []byte(`{"searcher_state": {"rand": {"key": [2970094109, 656686882, 618108684, 3428065983, 3347811667, 2888225350, 3059306387, 3429410465, 120474970, 2272301777, 985108865, 991558874, 3272543769, 1573748485, 942809215, 3888215743, 2210951765, 1718115507, 3963921664, 3557444060, 1499923783, 1829703377, 750493200, 3411092685, 589595500, 2596144409, 1879328096, 1280550458, 2715466210, 2544141428, 1543312021, 2997818084, 765128503, 536629897, 1001278031, 956821445, 2736363088, 947342293, 3898485884, 3425929255, 356849665, 3772908806, 3623557158, 2612581302, 3580922597, 217692149, 2059015628, 2096894728, 1031554394, 2656443257, 856730792, 2596152358, 3710976744, 3544672276, 1734608805, 481137749, 969621572, 754645566, 4116998116, 79516852, 3779707014, 84449565, 2299776967, 3049981717, 209980308, 730595889, 475796649, 176283770, 945344397, 3533051341, 1815446302, 3773966474, 2608085762, 3988702430, 1364580973, 954047394, 3612132653, 772541827, 644272441, 189803165, 931375382, 345347493, 1070927534, 1233280688, 2977342360, 964860546, 311939975, 4227569059, 1111154497, 2670796852, 2936307495, 1340846895, 2187526044, 4049656992, 2523649560, 3366534695, 4129435744, 2210183795, 1260247727, 3172172609, 845427714, 2412303263, 4029524955, 496281340, 1521525374, 1068147028, 715985502, 4093783277, 2159512480, 133552717, 436985375, 3034348399, 1875037974, 4060219881, 2429216519, 1706838315, 3704003030, 1782549491, 3768045061, 3989593374, 93865362, 1767865857, 1137597591, 252302268, 3084248212, 619916972, 4054361685, 2046158286, 1812194877, 3286982519, 3624326839, 2208625006, 3161233673, 3006516503, 2024883981, 1656495788, 587227161, 3021529118, 3172394998, 3398906615, 615744671, 3472224112, 212954520, 1118562041, 1921307781, 1197366600, 1484195533, 1200554730, 729716373, 1652264122, 1007315030, 2434524607, 585522965, 1141433277, 278327678, 3497727325, 356102370, 1394639384, 1857470125, 735035053, 2157227949, 2119739569, 171894210, 839804861, 1047866560, 420010537, 1667233883, 352520083, 1757099499, 2384088069, 251603325, 4218299275, 3730818711, 1003235663, 299940149, 2645812204, 2480727500, 1622974487, 1629312940, 3982198086, 2956489407, 2625953102, 1319536795, 42594099, 1983096735, 973960638, 3621842015, 3277003271, 2353057652, 181048897, 971058611, 596055263, 916085615, 181371615, 1523808158, 1627674241, 1944135612, 1287953114, 427398813, 3657156653, 2038254583, 1728892774, 2979810975, 1203810426, 870115982, 2342890482, 239526972, 161374077, 1298609642, 3361627384, 1120507760, 2857852335, 1817591908, 2278524994, 2381282828, 390752450, 2583666345, 2894166573, 1090621184, 1216468230, 2471775878, 4007164892, 4120390730, 2245347208, 1747432849, 2659194233, 3123421709, 1394627981, 3642599365, 447037831, 2948358439, 2071590290, 620060883, 1189294322, 865221550, 1072574172, 4239383229, 3932654708, 977824870, 4090083517, 996564545, 2215368799, 1639088756, 1063294874, 2589869379, 2931882145, 1119478531, 2913543435, 2863960600, 2220278034, 1514566588, 2171894117, 1040890154, 613591648, 4213726618, 3733950164, 3557521554, 451572785, 1963683489, 2910238750, 1724590625, 2276900333, 2786477774, 194531157, 2427295372, 2668452276, 3024832162, 4118825874, 2048453723, 602839057, 1287626269, 391207769, 1490752784, 631791025, 3012581026, 2165558496, 711793093, 394391602, 3030359078, 753489044, 1912791312, 805796394, 3405161241, 2387156388, 3012369288, 785079410, 1579291678, 2186594177, 1466653116, 2597054161, 2032480878, 2608593331, 245623596, 4030340391, 4102274438, 1820069747, 861878589, 1987396926, 1234162528, 4203068184, 4247911765, 675763300, 776602741, 2725860139, 1101969549, 2417348663, 3640520171, 4117232477, 1498968755, 1465742592, 978609897, 207663660, 3872867123, 2345883885, 3859129626, 2085742042, 2849699660, 766128209, 1220321488, 4036832842, 2625520262, 1672441713, 68307500, 1664835655, 4277760737, 2834495524, 1659112114, 4058377674, 3503936154, 3460939589, 1534417391, 546891454, 2119405354, 1342659996, 4063240713, 2470735676, 4263599371, 1004146457, 4110714736, 161171862, 3755105332, 2045654769, 3373580076, 3804959282, 172165195, 1513507373, 756508282, 2395802730, 1042880862, 424954450, 3528754016, 705074650, 1657675167, 3512260741, 1502017722, 3914739402, 2193244645, 2422500613, 99094108, 2136256596, 2765564582, 1469408647, 422762387, 4256532504, 2587902689, 322034733, 869598360, 1591826706, 3537194108, 432319981, 3238387140, 3998122956, 1638675667, 2820632381, 2704736212, 1001829652, 3842914244, 2163956861, 1247332102, 4161816793, 1047179830, 3332934466, 3373357404, 1755466786, 2066857771, 3041960543, 1984594045, 2873866111, 625922821, 2084260334, 647387503, 1795267011, 2734649093, 1429118207, 1763491842, 2499417212, 1322753865, 2546278618, 3069808828, 2758040961, 2095345089, 1117531393, 1079149953, 199028389, 5727143, 2626507809, 1394644924, 2371859674, 3378009021, 663183580, 1964126253, 4253076758, 1951862122, 3318205484, 246506769, 2065283265, 4062893977, 1357669276, 1910189941, 1768248614, 2642642591, 3082965658, 2821926795, 3387815148, 3811042618, 47443245, 1219528119, 2554982004, 3265451419, 2888244446, 4219157977, 970880074, 1607338684, 3191412771, 2649941819, 3075671217, 1402753481, 4075173340, 1295557797, 911791588, 847594689, 2359505701, 3661496760, 733404895, 249867897, 1640333750, 582965187, 1381547711, 2657453162, 1011026771, 2180307770, 52701968, 2169192963, 3746362727, 509530176, 4097693696, 406641367, 2522117714, 2016171603, 2069773173, 3084060900, 1332397153, 1412022588, 1875059352, 3676296777, 3375212542, 1306176142, 133024327, 2608708004, 139194617, 519502757, 1353538952, 3608390217, 3046145872, 1399364698, 4125351745, 572217286, 2142672378, 2889903141, 3434412210, 2393320012, 3956475466, 562179437, 3542566562, 3807446953, 1580557399, 3614175239, 3960865405, 3703717660, 2310530500, 1372501162, 3987983520, 2273295537, 3041676882, 1184238826, 1347025024, 1978741180, 1085872423, 3721856454, 4017856803, 3452381717, 2476724512, 3844971453, 3783643616, 1806640004, 945069700, 146817685, 3591154906, 3316795159, 3055211927, 3538095801, 2794589177, 2749831736, 3448467389, 2625023521, 183144251, 1181880302, 2668701387, 1211953638, 2740205019, 1424192308, 3005227360, 3518579311, 2030094765, 2163439322, 528876425, 713989960, 49680970, 3843683734, 2284197334, 754118913, 3660862775, 2811591585, 1900142815, 909665247, 3587945731, 1738555018, 4017103008, 363980482, 3596395463, 4036688775, 562009149, 652191781, 3255386890, 742878000, 9948449, 1293599923, 3198724758, 1824688996, 971993200, 545911088, 3111974979, 548678661, 3540201872, 347949716, 3899497825, 3919059349, 4023520489, 3906867502, 2926287461, 1975024135, 1961216548, 4241655703, 882861834, 447828602, 1073917811, 3204969134, 3637120523, 2561353660, 3087651888, 2625085299, 3045978593, 3296945077, 3353240266, 264317791, 3618427144, 3041663648, 3129441565, 1614617882, 742204376, 107307162, 4015043056, 164246162, 2971078786, 3420066832, 1704293461, 459244372, 744914593, 710366705, 2599447851, 3652089701, 712803605, 2980013293, 476563708, 1665840194, 1037190002, 3225477896, 1430942116, 2632665368, 3730881422, 1625879865, 363179597, 3829523707, 14110766, 1150504976, 2891936857, 256611346, 774302498, 184441060, 803067320, 3354307461, 2067530913, 466995748, 1177075098, 4068208859, 1923629384, 3949860772, 3830641659, 1017128665, 2972991357, 4238922926, 575232160, 101928834, 2405116568], "pos": 5}, "exits": {}, "failures": {}, "shutdown": false, "trials_closed": {}, "trial_progress": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": 0}, "trials_created": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": true}, "trials_requested": 1, "search_method_state": {"created_trials": 1, "pending_trials": 1, "search_method_type": "single"}, "completed_operations": {}}, "trial_searcher_state": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": {"Op": {"Length": {"batches": 937}, "RequestID": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06"}, "Closed": true, "Create": {"hparams": {"dropout1": 0.25, "dropout2": 0.5, "n_filters1": 32, "n_filters2": 64, "learning_rate": 1, "global_batch_size": 64}, "checkpoint": null, "request_id": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06", "trial_seed": 1757369869, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}}}`)
	//nolint:lll // Same.
	newSnapshot := []byte(`{"searcher_state": {"rand": {"key": [2970094109, 656686882, 618108684, 3428065983, 3347811667, 2888225350, 3059306387, 3429410465, 120474970, 2272301777, 985108865, 991558874, 3272543769, 1573748485, 942809215, 3888215743, 2210951765, 1718115507, 3963921664, 3557444060, 1499923783, 1829703377, 750493200, 3411092685, 589595500, 2596144409, 1879328096, 1280550458, 2715466210, 2544141428, 1543312021, 2997818084, 765128503, 536629897, 1001278031, 956821445, 2736363088, 947342293, 3898485884, 3425929255, 356849665, 3772908806, 3623557158, 2612581302, 3580922597, 217692149, 2059015628, 2096894728, 1031554394, 2656443257, 856730792, 2596152358, 3710976744, 3544672276, 1734608805, 481137749, 969621572, 754645566, 4116998116, 79516852, 3779707014, 84449565, 2299776967, 3049981717, 209980308, 730595889, 475796649, 176283770, 945344397, 3533051341, 1815446302, 3773966474, 2608085762, 3988702430, 1364580973, 954047394, 3612132653, 772541827, 644272441, 189803165, 931375382, 345347493, 1070927534, 1233280688, 2977342360, 964860546, 311939975, 4227569059, 1111154497, 2670796852, 2936307495, 1340846895, 2187526044, 4049656992, 2523649560, 3366534695, 4129435744, 2210183795, 1260247727, 3172172609, 845427714, 2412303263, 4029524955, 496281340, 1521525374, 1068147028, 715985502, 4093783277, 2159512480, 133552717, 436985375, 3034348399, 1875037974, 4060219881, 2429216519, 1706838315, 3704003030, 1782549491, 3768045061, 3989593374, 93865362, 1767865857, 1137597591, 252302268, 3084248212, 619916972, 4054361685, 2046158286, 1812194877, 3286982519, 3624326839, 2208625006, 3161233673, 3006516503, 2024883981, 1656495788, 587227161, 3021529118, 3172394998, 3398906615, 615744671, 3472224112, 212954520, 1118562041, 1921307781, 1197366600, 1484195533, 1200554730, 729716373, 1652264122, 1007315030, 2434524607, 585522965, 1141433277, 278327678, 3497727325, 356102370, 1394639384, 1857470125, 735035053, 2157227949, 2119739569, 171894210, 839804861, 1047866560, 420010537, 1667233883, 352520083, 1757099499, 2384088069, 251603325, 4218299275, 3730818711, 1003235663, 299940149, 2645812204, 2480727500, 1622974487, 1629312940, 3982198086, 2956489407, 2625953102, 1319536795, 42594099, 1983096735, 973960638, 3621842015, 3277003271, 2353057652, 181048897, 971058611, 596055263, 916085615, 181371615, 1523808158, 1627674241, 1944135612, 1287953114, 427398813, 3657156653, 2038254583, 1728892774, 2979810975, 1203810426, 870115982, 2342890482, 239526972, 161374077, 1298609642, 3361627384, 1120507760, 2857852335, 1817591908, 2278524994, 2381282828, 390752450, 2583666345, 2894166573, 1090621184, 1216468230, 2471775878, 4007164892, 4120390730, 2245347208, 1747432849, 2659194233, 3123421709, 1394627981, 3642599365, 447037831, 2948358439, 2071590290, 620060883, 1189294322, 865221550, 1072574172, 4239383229, 3932654708, 977824870, 4090083517, 996564545, 2215368799, 1639088756, 1063294874, 2589869379, 2931882145, 1119478531, 2913543435, 2863960600, 2220278034, 1514566588, 2171894117, 1040890154, 613591648, 4213726618, 3733950164, 3557521554, 451572785, 1963683489, 2910238750, 1724590625, 2276900333, 2786477774, 194531157, 2427295372, 2668452276, 3024832162, 4118825874, 2048453723, 602839057, 1287626269, 391207769, 1490752784, 631791025, 3012581026, 2165558496, 711793093, 394391602, 3030359078, 753489044, 1912791312, 805796394, 3405161241, 2387156388, 3012369288, 785079410, 1579291678, 2186594177, 1466653116, 2597054161, 2032480878, 2608593331, 245623596, 4030340391, 4102274438, 1820069747, 861878589, 1987396926, 1234162528, 4203068184, 4247911765, 675763300, 776602741, 2725860139, 1101969549, 2417348663, 3640520171, 4117232477, 1498968755, 1465742592, 978609897, 207663660, 3872867123, 2345883885, 3859129626, 2085742042, 2849699660, 766128209, 1220321488, 4036832842, 2625520262, 1672441713, 68307500, 1664835655, 4277760737, 2834495524, 1659112114, 4058377674, 3503936154, 3460939589, 1534417391, 546891454, 2119405354, 1342659996, 4063240713, 2470735676, 4263599371, 1004146457, 4110714736, 161171862, 3755105332, 2045654769, 3373580076, 3804959282, 172165195, 1513507373, 756508282, 2395802730, 1042880862, 424954450, 3528754016, 705074650, 1657675167, 3512260741, 1502017722, 3914739402, 2193244645, 2422500613, 99094108, 2136256596, 2765564582, 1469408647, 422762387, 4256532504, 2587902689, 322034733, 869598360, 1591826706, 3537194108, 432319981, 3238387140, 3998122956, 1638675667, 2820632381, 2704736212, 1001829652, 3842914244, 2163956861, 1247332102, 4161816793, 1047179830, 3332934466, 3373357404, 1755466786, 2066857771, 3041960543, 1984594045, 2873866111, 625922821, 2084260334, 647387503, 1795267011, 2734649093, 1429118207, 1763491842, 2499417212, 1322753865, 2546278618, 3069808828, 2758040961, 2095345089, 1117531393, 1079149953, 199028389, 5727143, 2626507809, 1394644924, 2371859674, 3378009021, 663183580, 1964126253, 4253076758, 1951862122, 3318205484, 246506769, 2065283265, 4062893977, 1357669276, 1910189941, 1768248614, 2642642591, 3082965658, 2821926795, 3387815148, 3811042618, 47443245, 1219528119, 2554982004, 3265451419, 2888244446, 4219157977, 970880074, 1607338684, 3191412771, 2649941819, 3075671217, 1402753481, 4075173340, 1295557797, 911791588, 847594689, 2359505701, 3661496760, 733404895, 249867897, 1640333750, 582965187, 1381547711, 2657453162, 1011026771, 2180307770, 52701968, 2169192963, 3746362727, 509530176, 4097693696, 406641367, 2522117714, 2016171603, 2069773173, 3084060900, 1332397153, 1412022588, 1875059352, 3676296777, 3375212542, 1306176142, 133024327, 2608708004, 139194617, 519502757, 1353538952, 3608390217, 3046145872, 1399364698, 4125351745, 572217286, 2142672378, 2889903141, 3434412210, 2393320012, 3956475466, 562179437, 3542566562, 3807446953, 1580557399, 3614175239, 3960865405, 3703717660, 2310530500, 1372501162, 3987983520, 2273295537, 3041676882, 1184238826, 1347025024, 1978741180, 1085872423, 3721856454, 4017856803, 3452381717, 2476724512, 3844971453, 3783643616, 1806640004, 945069700, 146817685, 3591154906, 3316795159, 3055211927, 3538095801, 2794589177, 2749831736, 3448467389, 2625023521, 183144251, 1181880302, 2668701387, 1211953638, 2740205019, 1424192308, 3005227360, 3518579311, 2030094765, 2163439322, 528876425, 713989960, 49680970, 3843683734, 2284197334, 754118913, 3660862775, 2811591585, 1900142815, 909665247, 3587945731, 1738555018, 4017103008, 363980482, 3596395463, 4036688775, 562009149, 652191781, 3255386890, 742878000, 9948449, 1293599923, 3198724758, 1824688996, 971993200, 545911088, 3111974979, 548678661, 3540201872, 347949716, 3899497825, 3919059349, 4023520489, 3906867502, 2926287461, 1975024135, 1961216548, 4241655703, 882861834, 447828602, 1073917811, 3204969134, 3637120523, 2561353660, 3087651888, 2625085299, 3045978593, 3296945077, 3353240266, 264317791, 3618427144, 3041663648, 3129441565, 1614617882, 742204376, 107307162, 4015043056, 164246162, 2971078786, 3420066832, 1704293461, 459244372, 744914593, 710366705, 2599447851, 3652089701, 712803605, 2980013293, 476563708, 1665840194, 1037190002, 3225477896, 1430942116, 2632665368, 3730881422, 1625879865, 363179597, 3829523707, 14110766, 1150504976, 2891936857, 256611346, 774302498, 184441060, 803067320, 3354307461, 2067530913, 466995748, 1177075098, 4068208859, 1923629384, 3949860772, 3830641659, 1017128665, 2972991357, 4238922926, 575232160, 101928834, 2405116568], "pos": 5}, "exits": {}, "failures": {}, "shutdown": false, "trials_closed": {}, "trial_progress": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": 0}, "trials_created": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": true}, "trials_requested": 1, "search_method_state": {"created_trials": 1, "pending_trials": 1, "search_method_type": "single"}, "completed_operations": {}}, "trial_searcher_state": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": {"Op": {"Length": 937, "RequestID": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06"}, "Closed": true, "Create": {"hparams": {"dropout1": 0.25, "dropout2": 0.5, "n_filters1": 32, "n_filters2": 64, "learning_rate": 1, "global_batch_size": 64}, "checkpoint": null, "request_id": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06", "trial_seed": 1757369869, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}}}`)
	actual, err := shimExperimentSnapshotV4(snapshot)
	require.NoError(t, err)
	require.JSONEq(t, string(newSnapshot), string(actual))
}

func TestDeserExperimentSnapshotIntoCurrent(t *testing.T) {
	// This test tries to deserialize a copy of a the current experiment snapshot.
	// If this test fails, it means there was a breaking change to snapshots which may've not
	// received a shim. Please ensure there is a shim and fix this test for the next time.
	tests := []struct {
		name       string
		experiment func() *experiment
		snapshot   []byte
	}{
		{
			name: "single",
			experiment: func() *experiment {
				e := &experiment{}
				//nolint:exhaustivestruct
				single := expconf.SearcherConfig{
					//nolint:exhaustivestruct
					RawSingleConfig: &expconf.SingleConfig{
						RawMaxLength: &expconf.Length{
							Unit:  expconf.Batches,
							Units: 937,
						},
					},
				}
				sm := searcher.NewSearchMethod(single)
				e.searcher = searcher.NewSearcher(0, sm, expconf.Hyperparameters{})
				return e
			},
			//nolint:lll
			snapshot: []byte(`{"searcher_state": {"rand": {"key": [2970094109, 656686882, 618108684, 3428065983, 3347811667, 2888225350, 3059306387, 3429410465, 120474970, 2272301777, 985108865, 991558874, 3272543769, 1573748485, 942809215, 3888215743, 2210951765, 1718115507, 3963921664, 3557444060, 1499923783, 1829703377, 750493200, 3411092685, 589595500, 2596144409, 1879328096, 1280550458, 2715466210, 2544141428, 1543312021, 2997818084, 765128503, 536629897, 1001278031, 956821445, 2736363088, 947342293, 3898485884, 3425929255, 356849665, 3772908806, 3623557158, 2612581302, 3580922597, 217692149, 2059015628, 2096894728, 1031554394, 2656443257, 856730792, 2596152358, 3710976744, 3544672276, 1734608805, 481137749, 969621572, 754645566, 4116998116, 79516852, 3779707014, 84449565, 2299776967, 3049981717, 209980308, 730595889, 475796649, 176283770, 945344397, 3533051341, 1815446302, 3773966474, 2608085762, 3988702430, 1364580973, 954047394, 3612132653, 772541827, 644272441, 189803165, 931375382, 345347493, 1070927534, 1233280688, 2977342360, 964860546, 311939975, 4227569059, 1111154497, 2670796852, 2936307495, 1340846895, 2187526044, 4049656992, 2523649560, 3366534695, 4129435744, 2210183795, 1260247727, 3172172609, 845427714, 2412303263, 4029524955, 496281340, 1521525374, 1068147028, 715985502, 4093783277, 2159512480, 133552717, 436985375, 3034348399, 1875037974, 4060219881, 2429216519, 1706838315, 3704003030, 1782549491, 3768045061, 3989593374, 93865362, 1767865857, 1137597591, 252302268, 3084248212, 619916972, 4054361685, 2046158286, 1812194877, 3286982519, 3624326839, 2208625006, 3161233673, 3006516503, 2024883981, 1656495788, 587227161, 3021529118, 3172394998, 3398906615, 615744671, 3472224112, 212954520, 1118562041, 1921307781, 1197366600, 1484195533, 1200554730, 729716373, 1652264122, 1007315030, 2434524607, 585522965, 1141433277, 278327678, 3497727325, 356102370, 1394639384, 1857470125, 735035053, 2157227949, 2119739569, 171894210, 839804861, 1047866560, 420010537, 1667233883, 352520083, 1757099499, 2384088069, 251603325, 4218299275, 3730818711, 1003235663, 299940149, 2645812204, 2480727500, 1622974487, 1629312940, 3982198086, 2956489407, 2625953102, 1319536795, 42594099, 1983096735, 973960638, 3621842015, 3277003271, 2353057652, 181048897, 971058611, 596055263, 916085615, 181371615, 1523808158, 1627674241, 1944135612, 1287953114, 427398813, 3657156653, 2038254583, 1728892774, 2979810975, 1203810426, 870115982, 2342890482, 239526972, 161374077, 1298609642, 3361627384, 1120507760, 2857852335, 1817591908, 2278524994, 2381282828, 390752450, 2583666345, 2894166573, 1090621184, 1216468230, 2471775878, 4007164892, 4120390730, 2245347208, 1747432849, 2659194233, 3123421709, 1394627981, 3642599365, 447037831, 2948358439, 2071590290, 620060883, 1189294322, 865221550, 1072574172, 4239383229, 3932654708, 977824870, 4090083517, 996564545, 2215368799, 1639088756, 1063294874, 2589869379, 2931882145, 1119478531, 2913543435, 2863960600, 2220278034, 1514566588, 2171894117, 1040890154, 613591648, 4213726618, 3733950164, 3557521554, 451572785, 1963683489, 2910238750, 1724590625, 2276900333, 2786477774, 194531157, 2427295372, 2668452276, 3024832162, 4118825874, 2048453723, 602839057, 1287626269, 391207769, 1490752784, 631791025, 3012581026, 2165558496, 711793093, 394391602, 3030359078, 753489044, 1912791312, 805796394, 3405161241, 2387156388, 3012369288, 785079410, 1579291678, 2186594177, 1466653116, 2597054161, 2032480878, 2608593331, 245623596, 4030340391, 4102274438, 1820069747, 861878589, 1987396926, 1234162528, 4203068184, 4247911765, 675763300, 776602741, 2725860139, 1101969549, 2417348663, 3640520171, 4117232477, 1498968755, 1465742592, 978609897, 207663660, 3872867123, 2345883885, 3859129626, 2085742042, 2849699660, 766128209, 1220321488, 4036832842, 2625520262, 1672441713, 68307500, 1664835655, 4277760737, 2834495524, 1659112114, 4058377674, 3503936154, 3460939589, 1534417391, 546891454, 2119405354, 1342659996, 4063240713, 2470735676, 4263599371, 1004146457, 4110714736, 161171862, 3755105332, 2045654769, 3373580076, 3804959282, 172165195, 1513507373, 756508282, 2395802730, 1042880862, 424954450, 3528754016, 705074650, 1657675167, 3512260741, 1502017722, 3914739402, 2193244645, 2422500613, 99094108, 2136256596, 2765564582, 1469408647, 422762387, 4256532504, 2587902689, 322034733, 869598360, 1591826706, 3537194108, 432319981, 3238387140, 3998122956, 1638675667, 2820632381, 2704736212, 1001829652, 3842914244, 2163956861, 1247332102, 4161816793, 1047179830, 3332934466, 3373357404, 1755466786, 2066857771, 3041960543, 1984594045, 2873866111, 625922821, 2084260334, 647387503, 1795267011, 2734649093, 1429118207, 1763491842, 2499417212, 1322753865, 2546278618, 3069808828, 2758040961, 2095345089, 1117531393, 1079149953, 199028389, 5727143, 2626507809, 1394644924, 2371859674, 3378009021, 663183580, 1964126253, 4253076758, 1951862122, 3318205484, 246506769, 2065283265, 4062893977, 1357669276, 1910189941, 1768248614, 2642642591, 3082965658, 2821926795, 3387815148, 3811042618, 47443245, 1219528119, 2554982004, 3265451419, 2888244446, 4219157977, 970880074, 1607338684, 3191412771, 2649941819, 3075671217, 1402753481, 4075173340, 1295557797, 911791588, 847594689, 2359505701, 3661496760, 733404895, 249867897, 1640333750, 582965187, 1381547711, 2657453162, 1011026771, 2180307770, 52701968, 2169192963, 3746362727, 509530176, 4097693696, 406641367, 2522117714, 2016171603, 2069773173, 3084060900, 1332397153, 1412022588, 1875059352, 3676296777, 3375212542, 1306176142, 133024327, 2608708004, 139194617, 519502757, 1353538952, 3608390217, 3046145872, 1399364698, 4125351745, 572217286, 2142672378, 2889903141, 3434412210, 2393320012, 3956475466, 562179437, 3542566562, 3807446953, 1580557399, 3614175239, 3960865405, 3703717660, 2310530500, 1372501162, 3987983520, 2273295537, 3041676882, 1184238826, 1347025024, 1978741180, 1085872423, 3721856454, 4017856803, 3452381717, 2476724512, 3844971453, 3783643616, 1806640004, 945069700, 146817685, 3591154906, 3316795159, 3055211927, 3538095801, 2794589177, 2749831736, 3448467389, 2625023521, 183144251, 1181880302, 2668701387, 1211953638, 2740205019, 1424192308, 3005227360, 3518579311, 2030094765, 2163439322, 528876425, 713989960, 49680970, 3843683734, 2284197334, 754118913, 3660862775, 2811591585, 1900142815, 909665247, 3587945731, 1738555018, 4017103008, 363980482, 3596395463, 4036688775, 562009149, 652191781, 3255386890, 742878000, 9948449, 1293599923, 3198724758, 1824688996, 971993200, 545911088, 3111974979, 548678661, 3540201872, 347949716, 3899497825, 3919059349, 4023520489, 3906867502, 2926287461, 1975024135, 1961216548, 4241655703, 882861834, 447828602, 1073917811, 3204969134, 3637120523, 2561353660, 3087651888, 2625085299, 3045978593, 3296945077, 3353240266, 264317791, 3618427144, 3041663648, 3129441565, 1614617882, 742204376, 107307162, 4015043056, 164246162, 2971078786, 3420066832, 1704293461, 459244372, 744914593, 710366705, 2599447851, 3652089701, 712803605, 2980013293, 476563708, 1665840194, 1037190002, 3225477896, 1430942116, 2632665368, 3730881422, 1625879865, 363179597, 3829523707, 14110766, 1150504976, 2891936857, 256611346, 774302498, 184441060, 803067320, 3354307461, 2067530913, 466995748, 1177075098, 4068208859, 1923629384, 3949860772, 3830641659, 1017128665, 2972991357, 4238922926, 575232160, 101928834, 2405116568], "pos": 5}, "exits": {}, "failures": {}, "shutdown": false, "trials_closed": {}, "trial_progress": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": 0}, "trials_created": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": true}, "trials_requested": 1, "search_method_state": {"created_trials": 1, "pending_trials": 1, "search_method_type": "single"}, "completed_operations": {}}, "trial_searcher_state": {"bb239c3a-c6b5-4ef3-ba7b-118038bd0d06": {"Op": {"Length": 937, "RequestID": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06"}, "Closed": true, "Create": {"hparams": {"dropout1": 0.25, "dropout2": 0.5, "n_filters1": 32, "n_filters2": 64, "learning_rate": 1, "global_batch_size": 64}, "checkpoint": null, "request_id": "bb239c3a-c6b5-4ef3-ba7b-118038bd0d06", "trial_seed": 1757369869, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}}}`),
		},
		{
			name: "asha",
			experiment: func() *experiment {
				e := &experiment{}
				//nolint:exhaustivestruct
				asha := expconf.SearcherConfig{
					//nolint:exhaustivestruct
					RawAsyncHalvingConfig: &expconf.AsyncHalvingConfig{
						RawNumRungs: ptrs.Ptr(4),
						RawStopOnce: ptrs.Ptr(false),
						RawMaxLength: &expconf.Length{
							Unit:  expconf.Batches,
							Units: 937,
						},
						RawDivisor: ptrs.Ptr[float64](4),
					},
					RawSmallerIsBetter: ptrs.Ptr(true),
				}
				sm := searcher.NewSearchMethod(asha)
				e.searcher = searcher.NewSearcher(0, sm, expconf.Hyperparameters{})
				return e
			},
			//nolint:lll
			snapshot: []byte(`{"searcher_state": {"rand": {"key": [1858898874, 3136713915, 1245759550, 1290970761, 517441830, 3965724506, 3061357240, 170072766, 1693351111, 4075410292, 78151388, 3493175442, 451004311, 1812236155, 355118118, 2341554586, 3606578038, 1939667144, 2365456278, 4240753950, 3356447601, 2335017104, 2040721097, 3800998272, 2728642800, 2131115629, 492734985, 2819783747, 3003215375, 4204037864, 4126695697, 549891058, 734125689, 31409235, 985387360, 3038862999, 954240667, 2621873052, 1848091170, 133174459, 3856584872, 124845556, 460434664, 46791082, 4152381650, 4173967752, 1247237436, 174835189, 1742324874, 2007241764, 1640712598, 2310183041, 3511885426, 578000042, 706952488, 3805905197, 1542555822, 1232482704, 113479587, 2075606872, 1810250676, 4154209381, 4104047634, 2798916177, 1973933529, 2923443846, 448405122, 3166808065, 2849599398, 468126651, 2661086816, 1991933754, 682920740, 2267700733, 4109317397, 1130169565, 3047640000, 3252889878, 3054398763, 2806904880, 2855243624, 3038966390, 1241065902, 2729169001, 815645434, 1162355224, 704271692, 536316416, 2670268274, 4163301069, 4085384831, 291065618, 1546534018, 1328639211, 2136729346, 1649093914, 1950870460, 3051014222, 4026077910, 2922618107, 2381221227, 1814305839, 2087985637, 4161848789, 128854472, 2943029177, 728532032, 3490598714, 669817953, 2440038690, 3555401139, 2712280152, 384719815, 2442045992, 613477876, 1377552755, 2711705298, 3724688321, 4067433634, 1545601253, 646274014, 1377898108, 240985165, 371546231, 3046184253, 2117921649, 2247989848, 2061520991, 956268219, 97033364, 175144327, 1353593441, 1476979375, 454979253, 762796608, 2575191972, 107577675, 1028450605, 1873422748, 2542366410, 1866320548, 3589705747, 345592247, 2892036283, 3170978743, 3572903695, 3028956090, 2207819198, 1950852740, 1313260327, 3971819579, 1504837033, 4070108073, 359514223, 1902603031, 3271335576, 3157069217, 2191931698, 1256929557, 421027589, 4212835066, 4062519531, 296513181, 2106428114, 549774238, 393306693, 1174412267, 3955316363, 2441986612, 1523312170, 982121345, 1785954095, 4080295649, 299131628, 393188011, 3374589678, 4024606822, 1686014117, 1197296932, 2797619434, 3649470375, 2716003058, 86300908, 3697562572, 3237922847, 1160822791, 3374522836, 3979525117, 2212718065, 1148293750, 1919573177, 3469185829, 1712413795, 380808588, 471126594, 948789273, 3532936578, 296952917, 2753628341, 2057043750, 920211988, 600572981, 2774709890, 1819324959, 2259319642, 574572799, 3073898101, 3230354882, 2678617999, 3641549837, 2132486047, 2765479196, 1727422873, 3997112925, 471821958, 92070175, 619429912, 1550462124, 2347682773, 1567881080, 1842852436, 3821419603, 3591165196, 2535124603, 3618924873, 2628843537, 1170033179, 348211080, 3822572799, 749527186, 1398111115, 727305496, 3543922887, 1648448468, 917342585, 3626786227, 795087139, 3407120437, 3355836138, 1410515106, 2720308312, 3240564741, 3959711847, 1124409684, 552560209, 3461944805, 678032564, 1103992569, 2470254354, 1641770510, 1556963167, 2379222670, 442642977, 2742252027, 1950349383, 2063177700, 2732950260, 4185258652, 2168049423, 1082372904, 1362620822, 1741310903, 901367838, 3508554445, 1348790639, 2317903621, 3373951142, 1337343925, 3840044638, 1485094307, 4248249804, 4093032023, 2136011, 1334492457, 2503063800, 2538115118, 2466171479, 1639514097, 464469616, 1764593097, 4213907472, 3313535300, 1076926430, 1725535044, 1011006056, 3988586498, 2745469741, 2906100946, 3576331813, 82093349, 429491095, 2114758070, 933184772, 3917920972, 1890858429, 531920684, 2456575097, 420691463, 748296319, 1079814478, 4024156541, 813238500, 1077678765, 2465759496, 3962103589, 2065972465, 3456128976, 2094509478, 2645396852, 2925520141, 1161978458, 2035040231, 4099469514, 1972456981, 3786725514, 3058419285, 3818057337, 2430215031, 1937931725, 2515478709, 1847103536, 4155632999, 1328666540, 4158737985, 2754971121, 2211399759, 2853435464, 3261493685, 4150017738, 3342340355, 775224247, 2961220606, 614027509, 3160064455, 3414222376, 2091154502, 280950518, 925950753, 566408845, 2596638294, 3135099147, 2706786311, 1388405449, 2816679388, 1623101484, 3178371694, 3291179795, 4116991785, 67859698, 845643000, 760347068, 1455100406, 2912358999, 2105127, 702301878, 1202736257, 1342813496, 575012872, 1865672624, 2657430022, 644622144, 2333997711, 1488359185, 4066857739, 3973656318, 2828413897, 3450795915, 1884785401, 1930824357, 1051770001, 3572092020, 1862280154, 3461196456, 3800146563, 1633638066, 1452346239, 534900790, 3121061430, 2916315663, 4255721426, 2887119093, 1871569903, 1332276432, 654698363, 3249099829, 863175434, 136189354, 3475430455, 2548971290, 2855268040, 3442424632, 804140083, 3514822970, 3941128355, 1313049612, 2892025674, 704113086, 2375636355, 3010471523, 1804040519, 682699732, 3588164492, 2899686231, 1835583680, 1773430431, 1098795657, 593519929, 125730791, 3274894119, 3824589328, 378493220, 1626526963, 3831253813, 3392887684, 1584863613, 3559778327, 2663823706, 3923032836, 3600949771, 1780734363, 3234463836, 3308378262, 1986979169, 2249473811, 2903716227, 3677580360, 1437072767, 3381143691, 3635683729, 3252548987, 1423467992, 1159796525, 126415660, 1073122400, 4213681404, 1155308855, 2805178822, 2953363327, 2150137973, 3240821181, 1698262113, 3278041312, 1513835831, 594252990, 2719832498, 2171241681, 3185876351, 1036634921, 1136285885, 4293927994, 2470722457, 4240063557, 2637317952, 161087848, 4147589514, 3912003562, 3965637509, 2793578416, 2291662622, 3749525828, 4282881950, 3280195163, 484269631, 2746175909, 3446976909, 2867607820, 395936285, 3321864120, 4273485048, 1086468822, 2838328381, 1644558158, 1834777629, 483686628, 1256155081, 2330382284, 2755082552, 4194834958, 391405988, 3209673909, 1870065414, 3052141802, 775165415, 4149272392, 194931648, 2367265709, 3891336490, 1229306547, 3012235584, 3643629589, 832189420, 469287166, 1525326108, 267712853, 410832606, 3637702001, 1293947797, 2676100704, 3127780282, 1522722013, 2987243003, 4223119695, 2471565775, 3741486091, 2517288835, 1421919913, 2170944291, 3677925623, 2433847083, 2055300628, 1274730272, 4194354236, 3445728648, 1457079160, 530533758, 2650792665, 3386458153, 2521874364, 1903579212, 761566114, 1632275601, 3215030020, 14846682, 3063448941, 726016154, 2228712970, 4195077512, 4196716184, 2434034522, 1909349859, 3301955567, 2777200877, 4292042460, 1199269432, 685902762, 2499240636, 1122335115, 439154079, 4168729086, 496834902, 2182051026, 4131884045, 1839561063, 39520120, 866177038, 827878713, 1764316880, 206451689, 2373512346, 2172390722, 3933252186, 3127637834, 2071541478, 3960855872, 1444619351, 1938511308, 3721638501, 1259236365, 4226881135, 610757816, 838627681, 1588715647, 1972104498, 2054289333, 419545885, 2474876715, 1254095866, 634279673, 3761069612, 1633198557, 2273078632, 3566317607, 1787529366, 1415431672, 3275737983, 2504574445, 430721643, 2335224241, 4010159314, 3152956030, 3456999186, 3382584293, 2802928282, 1378465088, 4251009334, 2588165208, 243375617, 3821815786, 4098223378, 4161610756, 1935733261, 2023780182, 3371959456, 2139155484, 2612371408, 338927672, 147433055, 1797581704, 3653488639, 2425792923, 888477626, 3057409903, 1694686933, 4004894142, 1992613109, 370443325, 227467078, 3544764567, 491152413, 2983604173, 2939234591, 157854636, 464880009, 2362768353, 2772766616, 932280116, 1106584051, 2213427382, 2869551831, 1522462666, 2481374380, 2796644796, 753754775, 1586605155], "pos": 112}, "exits": {}, "failures": {}, "shutdown": false, "trials_closed": {}, "trial_progress": {"3a77d780-1fb2-4af0-ae41-180c346cfcf8": 0}, "trials_created": {"3a77d780-1fb2-4af0-ae41-180c346cfcf8": true}, "trials_requested": 16, "search_method_state": {"trial_table": {"1648b3b2-74e9-439f-8e94-bfae278ea93d": 1, "19e57eb7-eb24-46fa-b740-21caab57a9d1": 1, "2bd1e7ff-5103-41df-9fa3-1ff4fc7acc14": 0, "306cd910-0605-4c85-84f3-5e6757ea1d01": 1, "3a77d780-1fb2-4af0-ae41-180c346cfcf8": 1, "45e6cca0-42a6-44be-8b58-88b20b00357e": 0, "65b30b87-e141-41fe-8816-7e1ee1a0ff36": 0, "69129b1e-843a-4879-8d8a-d0d02b696649": 0, "b383f52f-10be-4c55-adb7-2d0f75d6686d": 0, "beda8c08-e5b9-4861-b39c-c4e866297709": 0, "bf2b30d7-301f-48bb-8b35-a20b341291cb": 1, "cea43969-c629-4d82-830f-dcb47319e025": 1, "d8342b8c-3925-4ae8-b142-0b552b98223d": 1, "eee2da18-1bd9-449e-b247-906917d06878": 0, "fad2b882-e6cd-4f57-b285-613e3e699933": 0, "fafa3fd7-6bf5-447f-8ef8-f5001060b767": 1}, "sub_search_states": [{"rungs": [{"metrics": null, "start_trials": 0, "units_needed": 40, "promote_trials": 0, "outstanding_trials": 0}, {"metrics": null, "start_trials": 0, "units_needed": 200, "promote_trials": 0, "outstanding_trials": 0}, {"metrics": null, "start_trials": 0, "units_needed": 840, "promote_trials": 0, "outstanding_trials": 0}], "trial_rungs": {"2bd1e7ff-5103-41df-9fa3-1ff4fc7acc14": 0, "45e6cca0-42a6-44be-8b58-88b20b00357e": 0, "65b30b87-e141-41fe-8816-7e1ee1a0ff36": 0, "69129b1e-843a-4879-8d8a-d0d02b696649": 0, "b383f52f-10be-4c55-adb7-2d0f75d6686d": 0, "beda8c08-e5b9-4861-b39c-c4e866297709": 0, "eee2da18-1bd9-449e-b247-906917d06878": 0, "fad2b882-e6cd-4f57-b285-613e3e699933": 0}, "closed_trials": {}, "invalid_trials": 0, "pending_trials": 8, "trials_completed": 0, "early_exit_trials": {}, "search_method_type": "asha"}, {"rungs": [{"metrics": null, "start_trials": 0, "units_needed": 160, "promote_trials": 0, "outstanding_trials": 1}, {"metrics": null, "start_trials": 0, "units_needed": 800, "promote_trials": 0, "outstanding_trials": 0}], "trial_rungs": {"1648b3b2-74e9-439f-8e94-bfae278ea93d": 0, "19e57eb7-eb24-46fa-b740-21caab57a9d1": 0, "306cd910-0605-4c85-84f3-5e6757ea1d01": 0, "3a77d780-1fb2-4af0-ae41-180c346cfcf8": 0, "bf2b30d7-301f-48bb-8b35-a20b341291cb": 0, "cea43969-c629-4d82-830f-dcb47319e025": 0, "d8342b8c-3925-4ae8-b142-0b552b98223d": 0, "fafa3fd7-6bf5-447f-8ef8-f5001060b767": 0}, "closed_trials": {}, "invalid_trials": 0, "pending_trials": 8, "trials_completed": 0, "early_exit_trials": {}, "search_method_type": "asha"}], "search_method_type": "adaptive_asha", "sub_search_units_completed": [0, 0]}, "completed_operations": {}}, "trial_searcher_state": {"1648b3b2-74e9-439f-8e94-bfae278ea93d": {"Op": {"Length": 160, "RequestID": "1648b3b2-74e9-439f-8e94-bfae278ea93d"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.5750164976379073, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "1648b3b2-74e9-439f-8e94-bfae278ea93d", "trial_seed": 2143610236, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "19e57eb7-eb24-46fa-b740-21caab57a9d1": {"Op": {"Length": 160, "RequestID": "19e57eb7-eb24-46fa-b740-21caab57a9d1"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.5816375181302468, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "19e57eb7-eb24-46fa-b740-21caab57a9d1", "trial_seed": 421951454, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "2bd1e7ff-5103-41df-9fa3-1ff4fc7acc14": {"Op": {"Length": 40, "RequestID": "2bd1e7ff-5103-41df-9fa3-1ff4fc7acc14"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.7684118342109852, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "2bd1e7ff-5103-41df-9fa3-1ff4fc7acc14", "trial_seed": 212852662, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "306cd910-0605-4c85-84f3-5e6757ea1d01": {"Op": {"Length": 160, "RequestID": "306cd910-0605-4c85-84f3-5e6757ea1d01"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.8331292167743722, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "306cd910-0605-4c85-84f3-5e6757ea1d01", "trial_seed": 1609725763, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "3a77d780-1fb2-4af0-ae41-180c346cfcf8": {"Op": {"Length": 160, "RequestID": "3a77d780-1fb2-4af0-ae41-180c346cfcf8"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.8471874828144244, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "3a77d780-1fb2-4af0-ae41-180c346cfcf8", "trial_seed": 2105514700, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "45e6cca0-42a6-44be-8b58-88b20b00357e": {"Op": {"Length": 40, "RequestID": "45e6cca0-42a6-44be-8b58-88b20b00357e"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.7217543249722611, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "45e6cca0-42a6-44be-8b58-88b20b00357e", "trial_seed": 1245324437, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "65b30b87-e141-41fe-8816-7e1ee1a0ff36": {"Op": {"Length": 40, "RequestID": "65b30b87-e141-41fe-8816-7e1ee1a0ff36"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.8213712160318751, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "65b30b87-e141-41fe-8816-7e1ee1a0ff36", "trial_seed": 599927259, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "69129b1e-843a-4879-8d8a-d0d02b696649": {"Op": {"Length": 40, "RequestID": "69129b1e-843a-4879-8d8a-d0d02b696649"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.8661962084783181, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "69129b1e-843a-4879-8d8a-d0d02b696649", "trial_seed": 1023174740, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "b383f52f-10be-4c55-adb7-2d0f75d6686d": {"Op": {"Length": 40, "RequestID": "b383f52f-10be-4c55-adb7-2d0f75d6686d"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.5359870317307868, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "b383f52f-10be-4c55-adb7-2d0f75d6686d", "trial_seed": 1099784968, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "beda8c08-e5b9-4861-b39c-c4e866297709": {"Op": {"Length": 40, "RequestID": "beda8c08-e5b9-4861-b39c-c4e866297709"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.7829296920408424, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "beda8c08-e5b9-4861-b39c-c4e866297709", "trial_seed": 1740151796, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "bf2b30d7-301f-48bb-8b35-a20b341291cb": {"Op": {"Length": 160, "RequestID": "bf2b30d7-301f-48bb-8b35-a20b341291cb"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.6767256393511032, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "bf2b30d7-301f-48bb-8b35-a20b341291cb", "trial_seed": 981345028, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "cea43969-c629-4d82-830f-dcb47319e025": {"Op": {"Length": 160, "RequestID": "cea43969-c629-4d82-830f-dcb47319e025"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.854520819444287, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "cea43969-c629-4d82-830f-dcb47319e025", "trial_seed": 575167432, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "d8342b8c-3925-4ae8-b142-0b552b98223d": {"Op": {"Length": 160, "RequestID": "d8342b8c-3925-4ae8-b142-0b552b98223d"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.7231724660254734, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "d8342b8c-3925-4ae8-b142-0b552b98223d", "trial_seed": 2032674049, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "eee2da18-1bd9-449e-b247-906917d06878": {"Op": {"Length": 40, "RequestID": "eee2da18-1bd9-449e-b247-906917d06878"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.8005169955058526, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "eee2da18-1bd9-449e-b247-906917d06878", "trial_seed": 1209630132, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "fad2b882-e6cd-4f57-b285-613e3e699933": {"Op": {"Length": 40, "RequestID": "fad2b882-e6cd-4f57-b285-613e3e699933"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.6903862897512029, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "fad2b882-e6cd-4f57-b285-613e3e699933", "trial_seed": 86866247, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}, "fafa3fd7-6bf5-447f-8ef8-f5001060b767": {"Op": {"Length": 160, "RequestID": "fafa3fd7-6bf5-447f-8ef8-f5001060b767"}, "Closed": false, "Create": {"hparams": {"metrics_base": 0.5785735939157665, "metrics_sigma": 0, "global_batch_size": 32, "metrics_progression": "decreasing"}, "checkpoint": null, "request_id": "fafa3fd7-6bf5-447f-8ef8-f5001060b767", "trial_seed": 1213847999, "workload_sequencer_type": "TRIAL_WORKLOAD_SEQUENCER"}, "Complete": false}}}`),
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tt.experiment()
			require.NoError(t, e.Restore(tt.snapshot))
		})
	}
}
