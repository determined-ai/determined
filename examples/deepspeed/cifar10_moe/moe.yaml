name: cifar10_pytorch_distributed
debug: false
hyperparameters:
  global_batch_size: 64
  deepspeed_config: ds_config.json
  moe: true
  ep_world_size: 2
  num_experts: 4
  top_k: 1
  min_capacity: 0
  noisy_gate_policy: null
  moe_param_group: false

environment:
    #environment_variables:
    #    - CUDA_LAUNCH_BLOCKING=1
    #    - NCCL_BLOCKING_WAIT=1
    #    - NCCL_DEBUG=INFO
    #    - NCCL_IB_DISABLE=1
    image:
        gpu: determinedai/environments:cuda-11.1-pytorch-1.9-lightning-1.3-tf-2.4-deepspeed-0.5.10-gpu-0.17.9
bind_mounts:
    - host_path: /tmp
      container_path: /data
    - host_path: /tmp
      container_path: /root/.cache
resources:
  slots_per_trial: 4
records_per_epoch: 50000
searcher:
  name: single
  metric: accuracy
  smaller_is_better: false
  max_length:
    epochs: 3
entrypoint: 
  - python3
  - -m
  - determined.launch.autodeepspeed
  - model_def:CIFARTrial
min_validation_period:
  batches: 100
max_restarts: 0
