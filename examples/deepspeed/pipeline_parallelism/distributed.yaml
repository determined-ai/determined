name: cifar10_pipeline_parallel_deepspeed
debug: false
hyperparameters:
  global_batch_size: 256
  deepspeed_config: ds_config.json
  pipe_parallel_size: 2
  part: parameters
  overwrite_deepspeed_args:
    train_micro_batch_size_per_gpu: 8
bind_mounts:
  - host_path: /tmp
    container_path: /data
  - host_path: /tmp
    container_path: /root/.cache
environment:
    #force_pull_image: true
    #environment_variables:
    #  - CUDA_LAUNCH_BLOCKING=1
    #  - NCCL_BLOCKING_WAIT=1
    image:
      gpu: determinedai/environments:cuda-11.1-pytorch-1.9-lightning-1.5-tf-2.4-deepspeed-0.5.10-gpu-5158dec
resources:
  slots_per_trial: 2
records_per_epoch: 50000
searcher:
  name: single
  metric: loss
  smaller_is_better: false
  max_length:
    batches: 1000
entrypoint: 
  - python3
  - -m
  - determined.launch.autodeepspeed
  - model_def:CIFARTrial
max_restarts: 0
checkpoint_policy: none
