name: shiftvit_imagenet_distributed
entrypoint: model_def:ShiftViTTrial
data:
  dataset_name: imagenet
  # TODO: Change this to the name of your bucket.
  gcs_bucket: determined-ai-datasets
  # TODO: Path to files inside the above bucket that contain newline separated list of all image blob paths.
  # Generate using generate_blob_list.py
  gcs_train_blob_list_path: imagenet/imagenet/train-blob-list.txt
  gcs_validation_blob_list_path: imagenet/imagenet/validation-blob-list.txt
  num_workers: 8
  pin_memory: True
  # ShfitViT default training augmentations
  transform:
    color_jitter: 0.4
    auto_augment: rand-m9-mstd0.5-inc1
    interpolation: bicubic
    re_prob: 0.25
    re_mode: pixel
    re_count: 1
records_per_epoch: 2048 #1271158
hyperparameters:
  n_div: 12
  patch_size: 4
  embed_dim: 96
  depths: [2, 2, 6, 2]
  mlp_ratio: 4.0
  drop_rate: 0.0
  drop_path_rate: 0.1
  norm_layer: GN1
  act_layer: GELU
  patch_norm: True
  use_checkpoint: False
  # ShiftViT ImageNet experiments use batch_size = 1024
  global_batch_size: 1024
  # ShiftViT optimizer defaults
  optimizer:
    opt: adamw
    lr: 5.0e-4
    opt_eps: 1.0e-8
    opt_betas: null
    clip_gard: null
    momentum: 0.9
    weight_decay: 0.05
  # ShiftViT scheduler defaults
  scheduler:
    sched: cosine
    # ShiftViT ImageNet experiments train for 300 epochs, reduced here for cost. Other scheduler parameters
    # follow ShiftViT defaults.
    epochs: &epochs 5 # epochs variable reused in 'searcher'
    lr_noise: null
    lr_noise_pct: 0.67
    lr_noise_std: 1.0
    warmup_lr: 1.0e-6
    min_lr: 1.0e-5
    decay_epochs: 30
    warmup_epochs: 20
    cooldown_epochs: 20
    patience_epochs: 10
    decay_rate: 0.1
min_validation_period:
  epochs: 1000 #1
resources:
  slots_per_trial: 8
  shm_size: 17179869184 # 16 GiB
searcher:
  name: single
  metric: validation_loss
  max_length:
    epochs: *epochs
  smaller_is_better: true
max_restarts: 1
profiling:
  enabled: True
optimizations:
  average_training_metrics: True