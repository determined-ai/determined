{{- if .Values.genai.version }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: genai-resource-pool-metadata-{{ .Release.Name }}
  namespace: {{ .Release.Namespace }}
  labels:
    app: genai-{{ .Release.Name }}
    release: {{ .Release.Name }}
data:
  resource_pool_metadata.yaml: |
    # FOUND ELEMS
    {{- $orig_resource_pool_data := (required "A valid .Values.resourcePools entry required!" .Values.resourcePools) }}
    {{- $resource_pools := dict -}}
    {{- range $v := $orig_resource_pool_data }}
      {{ $resource_pools := mustAppend $resource_pools $v.pool_name }}
    {{- end }}
    # WOW
    {{ $resource_pools }}
    {{- $metadata := (required "A valid .Values.genai.extra_resource_pool_metadata entry required!" .Values.genai.extra_resource_pool_metadata) }}
    {{- range $k, $v := $metadata }}
      {{- if has $k $resource_pools }}
        {{- $k }}
      {{- end }}
    {{- end }}
    # ORIG
    {{- toYaml .Values.genai.extra_resource_pool_metadata | nindent 4 }}
{{- end }}
